var browserStorage=function(){"use strict";function e(e){return new Promise(function(n,t){var r=e(function(e){return l.runtime.lastError?t(l.runtime.lastError):void n(e)});"object"==typeof r&&"function"==typeof r.then&&n(r)})["catch"](function(){return e()})}function n(e){return function(n){return e(n).then(function(e){return e[n]})}}function t(e){return function(n,t){var r={};return r[n]=t,e(r)}}function r(){return i.sync?_.get("local","__sync_fallback__").then(function(e){return!e.__sync_fallback__||_.get("local",null).then(function(e){var n=["__sync_fallback__"],t={};return Object.keys(e).forEach(function(r){r.startsWith("__sync_storage__")&&(n.push(r),t[r.replace("__sync_storage__","")]=e[r])}),Promise.all([_.set("sync",t),_.remove("local",n)])}).then(function(){return!0})}):Promise.resolve(!1)}function o(){var e={getBytesInUse:_.getBytesInUse.bind(null,"local"),set:_.set.bind(null,"local"),remove:_.remove.bind(null,"local")};return f?(e.get=function(e){return e?_.get("local",e):_.get("local",null).then(function(e){var n={};return Object.keys(e).forEach(function(t){t.startsWith("__sync_storage__")||"__sync_fallback__"===t||(n[t]=e[t])}),n})},e.clear=function(){return _.get("local",null).then(function(e){return Object.keys(e).filter(function(e){return!e.startsWith("__sync_storage__")})}).then(_.remove.bind(null,"local"))}):(e.get=_.get.bind(null,"local"),e.clear=_.clear.bind(null,"local")),e.getItem=n(e.get),e.setItem=t(e.set),e}function c(){var e={};if(!f)return e.get=_.get.bind(null,"sync"),e.set=_.set.bind(null,"sync"),e.remove=_.remove.bind(null,"sync"),e.clear=_.clear.bind(null,"sync"),e.getBytesInUse=_.getBytesInUse.bind(null,"sync"),e.getItem=n(e.get),e.setItem=t(e.set),e;var o=r();return e.get=function(e){return o.then(function(n){if(n)return _.get("sync",e);var t=null;return e&&(t="string"==typeof e?[e]:e,t=t.map(function(e){return"__sync_storage__"+e})),_.get("local",t).then(function(e){var n={};return Object.keys(e).forEach(function(t){t.startsWith("__sync_storage__")&&(n[t.replace("__sync_storage__","")]=e[t])}),n})})},e.set=function(e){return o.then(function(n){if(n)return _.set("sync",e);var t={__sync_fallback__:!0};return Object.keys(e).forEach(function(n){t["__sync_storage__"+n]=e[n]}),_.set("local",t)})},e.remove=function(e){return o.then(function(n){if(n)return _.remove("sync",e);var t="string"==typeof e?[e]:e;return t=t.map(function(e){return"__sync_storage__"+e}),_.remove("local",t)})},e.clear=function(){return o.then(function(e){return e?_.clear("sync"):_.get("local",null).then(function(e){return Object.keys(e).filter(function(e){return e.startsWith("__sync_storage__")})}).then(_.remove.bind(null,"local"))})},e.getBytesInUse=function(){return o.then(function(e){return e?_.getBytesInUse("sync"):0})},o.then(function(n){n&&(e.get=_.get.bind(null,"sync"),e.set=_.set.bind(null,"sync"),e.remove=_.remove.bind(null,"sync"),e.clear=_.clear.bind(null,"sync"))}),e.getItem=n(e.get),e.setItem=t(e.set),e}function u(){return Promise.reject(Error("Method not supported for this storage type"))}function s(){return{get:i.managed&&i.managed.get?_.get.bind(null,"managed"):function(){return Promise.resolve({})},set:u,remove:u,clear:u,getBytesInUse:function(){return Promise.resolve(0)},getItem:n(_.get),setItem:u}}var l="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,i=l.storage,a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,f=a;if(!i)throw new Error("Please add storage to the list of permissions in manifest.json");var _={get:function(n,t){return e(i[n].get.bind(null,t||null))},set:function(n,t){return e(i[n].set.bind(null,t))},remove:function(n,t){return e(i[n].remove.bind(null,t||null))},clear:function(n,t){return e(i[n].clear)},getBytesInUse:function(n,t){return e(i[n].getBytesInUse)}};return{managed:s(),local:o(),sync:c()}}();